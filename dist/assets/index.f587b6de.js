(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const _="https://www.reddit.com/r/all/top/.json?";async function E(){const t=await fetch(_+new URLSearchParams({limit:"100"})),{data:{children:r}}=await t.json();return console.log({children:r}),r}function P(t,r,s,i,e){return`{"version":"0.3.1","atoms":[],"cards":[],"markups":[["a",["href","https://reddit.com${e}"]]],"sections":[[1,"p",[[0,[],0,"Posted by ${t} in ${r} with ${s} upvotes and an upvote ratio of ${i*100}% "],[0,[0],1,"See the original post."]]]],"ghostVersion":"4.0"}`}function L(t){return t.endsWith("jpg")||t.endsWith("png")||t.endsWith("jpeg")||t.endsWith("webp")||t.endsWith("avif")?t:null}async function j(){const t=await E();if(!t)return;let r=[];const s=t.reduce((o,a,d)=>{const{data:{author:u,url:f,over_18:m,subreddit:l,title:h,ups:g,upvote_ratio:y,permalink:w,created_utc:b}}=a;if(m)return o;r.push(l);const S=P(u,l,g,y,w),v={id:d,title:h.substring(0,191),feature_image:L(f),mobiledoc:S,tags:[l],status:"published",published_at:new Date(b*1e3).toISOString()};return o.push(v),o},[]);let i=0;const e=r.reduce((o,a)=>(console.log(o,a),o.length?(o.some(u=>u.name===a)||o.push({id:i++,name:a}),o):(o.push({id:i++,name:a}),o)),[]),n=s.map(o=>{const{id:a}=e.find(d=>d.name===o.tags[0]);return{tag_id:a,post_id:o.id}});return console.log(n),{meta:{exported_on:Date.now(),version:"5.0.0"},data:{posts:s,tags:e,posts_tags:n}}}const p=document.querySelector("#generate");p==null||p.addEventListener("click",async()=>{var n,c;(n=document.querySelector("a"))==null||n.remove();const t=document.querySelector(".container"),r=document.createElement("p");r.textContent="Gettin' those spicy posts...",t.append(r);const s=await j();if(!s)throw Error("Can't complete operation. Please try again.");const i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(s)),e=document.createElement("a");if(e.textContent="Download",!e)throw Error("Something bad happened. Call a shrink");e==null||e.setAttribute("href",i),e==null||e.setAttribute("download","export.json"),(c=document.querySelector("p"))==null||c.remove(),t.append(e)});
